<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>Tour and Hotel Recommendation</title>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
    <!-- css  -->
    <link rel="stylesheet" href="public/css/sty.css">
    <script type="text/javascript" src="./public/javascript/nav.js"></script>


</head>

<body>


    <!-- main  -->
    <main>

        <!-- banner  -->

        <!-- explore  -->

        <!-- about  -->
        <section class="about" id="about">
            <!-- tour  -->
            
            <section class="tour" id="tour">
                <div class="main-text">
                    <h2>2021</h2>
                    <h1>Tours</h1>
                </div>
                <div class="main-container" id="main-container">
                    <!-- // card 1 -->
                    
                    <!-- ------ -->
                    <!-- card 2 -->
                    
                    <!-- ------  -->

                    <!-- cards 3  -->
                    <div class="tour-cards">
                        <div class="image-box">
                            <img src="https://images.unsplash.com/photo-1491466424936-e304919aada7?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=869&q=80"
                                alt="Stakkholtsgja canyon ">
                            <div class="overlay"></div>
                            <div class="image-box-text">
                                <h2>Stakkholtsgja</h2>
                                <p>Mountains & Waterfall</p>
                            </div>

                        </div>
                        <div class="tour-cards-text">
                            <h1>Stakkholtsgja canyon Trip</h1>
                            <p>A Week long trip around the south iceland with hiking guides. Stakkholtsgjá is a wondrous
                                canyon, situated in Southern part of the Icelandic Highlands. It is highly-known for the
                                magical hiking trail that leads to a majestic waterfall. The gorge is a part of the
                                Þórsmörk
                                Nature Reserve. Every bit
                                of Stakkholtsgjá canyon shines out with picturesque beauty. Stakkholtsgjá is about a
                                hundred
                                meters deep.</p>
                            <a href="#" class="btn-map">

                                <span>View Route Map</span>
                            </a>
                            <div class="price">
                                <p>$5200 <span>Per person</span></p>
                                <h2>18 Days 36 Nights</h2>
                            </div>
                        </div>
                    </div>
                    <!-- ------ -->
                </div>
                <button class="btn btn-view-all">
                    View More
                </button>
            </section>

    </main>



    </section>




</body>
     <script>
       const getuserid  = async () =>{
            try{
                const response =  await fetch('http://localhost:3000/api/v1/users/getuserfromtoken', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify({
                                    token:getCookie('token')
                                })
                            })
                const data =  await response.json()
                return data
            }
            catch(err){
                console.log(err)
            }
        } 
        function deleteCookie(name) {
            document.cookie = name + '=;expires=Thu, 01 Jan 1970 00:00:01 GMT;';
        }                  
        const resultsDiv = document.getElementById('main-container')
        
        fetch('http://localhost:3000/api/v1/tours',{
            method:'GET'
        })
            .then(response => response.json())
            .then(data => {
        
        
            data.data.forEach(tour => {
            const tourDiv = document.createElement('div');
            tourDiv.innerHTML = `
            <div class="tour-cards">
                        <div class="image-box">
                            <img src="https://images.unsplash.com/photo-1491466424936-e304919aada7?ixlib=rb-1.2.1&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=869&q=80"
                                alt="Stakkholtsgja canyon ">
                            <div class="overlay"></div>
                            <div class="image-box-text">
                                <h2>Stakkholtsgja</h2>
                                <p>Mountains & Waterfall</p>
                            </div>

                        </div>
                        <div class="tour-cards-text">
                            <h1>${tour.name}</h1>
                            <p>${tour.summary}</p>
                            <div class="price">
                                <p>${tour.price} <span>Per person</span></p>
                                <h2>Duration:${tour.duration}</h2>
                            </div>
                        </div>
                        
                        ${ fetch('http://localhost:3000/api/v1/bookings')
                            .then(response => response.json())
                            .then
                        }
                        <button onClick="booktour('${tour._id}','${tour.price}')">Book Tour</button>

            </div>
      `;
      resultsDiv.appendChild(tourDiv);
    });
})
.catch(error => console.error(error));
function getCookie(name) {
    const cookieValue = document.cookie.match('(^|;)\\s*' + name + '\\s*=\\s*([^;]+)');
    return cookieValue ? cookieValue.pop() : '';
                
}
    
const ifloggedin  = async () =>{
    try{
        const response =  await fetch('http://localhost:3000/api/v1/users/getuserfromtoken', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            token:getCookie('token')
                        })
                    })
         const data =  await response.json()
       
         const namediv =  document.getElementById('nameorlogin')
         namediv.href = 'logout.html'
         namediv.innerHTML =  `Logout ${data.name}`
         namediv.addEventListener('click',() =>{
                    deleteCookie('token')
                    namediv.href = 'index.html'
         })
        const addtour = document.getElementById('addtour')
        const adduser = document.getElementById('adduser')
        if(data.role == 'admin'){
            console.log(data.role)
            addtour.style.display = "block";
        }
        if(data.role == 'system-admin'){
            console.log(data.role)
            adduser.style.display = 'block'
        }
       }
       catch(err){
        console.log(err)
       }
}
if(getCookie('token')){
    console.log(getCookie('token'))
    ifloggedin()
}
function deleteCookie(name) {
  document.cookie = name + '=;expires=Thu, 01 Jan 1970 00:00:01 GMT;';
}
async function booktour(tour,price){
    const user = await getuserid()
    const userid = user._id
    const paid = false;
    try {
                    const response = await fetch('http://localhost:3000/api/v1/booking', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            tour,
                            userid,
                            price,
                            paid

                        })
                    });
    
                    const data = await response.json();
                   if(data){
                       alert('You have booked a tour')
                   }
                } catch (error) {
                    console.log(error.message);
                }
}
async function canceltour(tour,price){
    const user = await getuserid()
    const paid = false;
    try {
                    const response = await fetch('http://localhost:3000/api/v1/booking', {
                        method: 'DELETE',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            tour,
                            user,
                            price,
                            paid

                        })
                    });
    
                    const data = await response.json();
                    
                   console.log(data)
                } catch (error) {
                    console.log(error);
                }
}  
    
    
  
  
    </script>
</html>